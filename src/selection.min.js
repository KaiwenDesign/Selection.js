/*
 *  Selection 快速选择插件
 *
 *  作者: Kevin
 *  QQ: 870483093
 */

function Selection(option){this.state=true;this.option=$option={option:{e:'[selection-option]',checked:'selection-checked',},selector:{id:'selection-selector',class:'',zIndex:99999,click:true,deselect:true,whole:false,inner:true,},container:{e:'#selection-container',wall:true,range:true,select:false,prevent:false,propagation:false,},move:()=>{},selected:()=>{},...option}
this.selected=[];this.option=Object;const $element=selector=>{const type={string:()=>{const e=document.querySelectorAll(selector);return e.length>1?e:e[0]||undefined;},object:()=>{return selector},}
return type[typeof(selector)]();}
const $style=(selector,styles)=>{const style=(element)=>{Object.keys(styles).forEach(key=>{element.style[key]=styles[key];})}
const type={object:()=>style(selector),string:()=>$element(selector).forEach(element=>{style(element)}),}
type[typeof(selector)]();}
const mouse={start:{x:0,y:0,},area:{t:0,l:0,r:0,b:0,},down:event=>{$option.container.prevent&&event.preventDefault();$option.container.propagation&&event.stopPropagation();$element('#'+$option.selector.id)&&$element('#'+$option.selector.id).remove();$option.selector.deselect&&(this.selected=[],$element($option.option.e).forEach(e=>e.classList.remove($option.option.checked)));($option.selector.click&&!$option.selector.whole)&&($element($option.option.e).forEach(e=>e.classList.remove($option.option.checked)),event.path.forEach(e=>{try{this.option.forEach(eo=>{if(e==eo){throw new Error;}})}catch{e.classList.add($option.option.checked)
this.selected=[e];}}))
try{if(!$option.container.range){console.log('yes');throw new Error;}
event.path.forEach(element=>{if(element==$element($option.container.e)){throw new Error;}});}catch{document.addEventListener('mousemove',mouse.move)
mouse.start={x:event.x,y:event.y}
const selector=document.createElement('div');selector.setAttribute('id',$option.selector.id);$option.selector.class&&selector.classList.add($option.selector.class);$style(selector,{top:event.y+'px',left:event.x+'px',position:'absolute',zIndex:$option.selector.zIndex||99999,pointerEvents:'none',border:'1px solid rgb(0,122,255)',backgroundColor:'rgba(0,122,255,.08)'});document.body.appendChild(selector);}},up:()=>{$element('#'+$option.selector.id)&&$element('#'+$option.selector.id).remove();$option.selected(this.selected);document.removeEventListener('mousemove',mouse.move)},move:event=>{const _selector=$element('#'+$option.selector.id);const x=event.x-mouse.start.x;const y=event.y-mouse.start.y;const _container=$element($option.container.e);const c={l:_container.offsetLeft,t:_container.offsetTop,r:_container.offsetLeft+_container.clientWidth,b:_container.offsetTop+_container.clientHeight,}
const _width=$option.container.wall?Math.abs(mouse.start.x+x<c.l&&mouse.start.x-c.l||mouse.start.x+x>c.r&&mouse.start.x-c.r||x):Math.abs(x);const _height=$option.container.wall?Math.abs(mouse.start.y+y<c.t&&mouse.start.y-c.t||mouse.start.y+y>c.b&&mouse.start.y-c.b||y):Math.abs(y);$style(_selector,{width:_width+'px',height:_height+'px',transform:'translate('+(x<0?'-100%':'0%')+', '+(y<0?'-100%':'0%')+')',})
mouse.area={t:Math.min(mouse.start.y,event.y),l:Math.min(mouse.start.x,event.x),r:Math.max(mouse.start.x,event.x),b:Math.max(mouse.start.y,event.y),}
this.selected=this.option.filter(e=>{const c=mouse.area;const o={t:e.offsetTop,l:e.offsetLeft,r:e.offsetLeft+e.clientWidth,b:e.offsetTop+e.clientHeight}
const t=c.t<o.t&&o.t<c.b;const b=c.t<o.b&&o.b<c.b;const l=c.l<o.l&&o.l<c.r;const r=c.r>o.r&&o.r>c.l;const center_x=(c.l>o.l&&c.l<o.r)||(c.r<o.r&&c.r>o.l);const center_y=(c.t>o.t&&c.t<o.b)||(c.b<o.b&&c.b>o.t);const inner=c.l<o.l&&o.r<c.r&&c.r>o.r&&o.l>c.l&&c.t<o.t&&o.b<c.b&&c.b>o.b&&o.t>c.t;const _if=inner||(!$option.selector.whole&&($option.selector.inner&&(center_x&&center_y)||(t&&center_x)||(b&&center_x)||(l&&center_y)||(r&&center_y)));_if?e.classList.add($option.option.checked):e.classList.remove($option.option.checked);return _if?e:false;})
$option.move(this.selected);}}
this.mutation=()=>{document.addEventListener('mousedown',mouse.down);document.addEventListener('mouseup',mouse.up);!$option.container.select&&($element($option.container.e).style.userSelect='none');this.option=[].slice.call(document.querySelectorAll($option.container.e+" "+$option.option.e));}
this.stop=(callback=Function)=>{this.state=false
document.removeEventListener('mousedown',mouse.down);document.removeEventListener('mouseup',mouse.up);mouse.up();callback();};this.start=(callback=Function)=>{this.state=true
document.addEventListener('mousedown',mouse.down);document.addEventListener('mouseup',mouse.up);callback();};this.mutation();}